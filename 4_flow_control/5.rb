An end statement is missing from the if/else loop. The last read 'end' matches with the def method block.